# Sumber AI - Skrip Setup Supabase (Siap Produksi)

**PENTING:** Skrip ini akan mengkonfigurasi database Anda dengan Row Level Security (RLS) yang aktif. Ini adalah konfigurasi yang direkomendasikan untuk lingkungan produksi.

## Instruksi

Salin **seluruh isi skrip di bawah ini**, tempelkan ke **SQL Editor** di dashboard Supabase Anda, lalu klik **"Run"**. Ini akan membersihkan konfigurasi lama (jika ada) dan menerapkan struktur yang aman.

---

```sql
-- =============================================
-- BAGIAN 1: PEMBERSIHAN (OPSIONAL TAPI DIANJURKAN)
-- Menghapus semua yang lama untuk memastikan awal yang bersih.
-- =============================================
-- Matikan RLS sementara untuk menghapus tabel
ALTER TABLE IF EXISTS public.articles DISABLE ROW LEVEL SECURITY;
ALTER TABLE IF EXISTS public.profiles DISABLE ROW LEVEL SECURITY;

-- Hapus fungsi-fungsi helper dengan CASCADE untuk membersihkan semua dependensi.
DROP FUNCTION IF EXISTS public.handle_new_user() CASCADE;
DROP FUNCTION IF EXISTS public.get_current_user_role() CASCADE;

-- Hapus tabel-tabel.
DROP TABLE IF EXISTS public.articles;
DROP TABLE IF EXISTS public.profiles;

-- =============================================
-- BAGIAN 2: PEMBUATAN STRUKTUR DENGAN KEAMANAN (RLS)
-- =============================================

-- 2.1. Buat tabel 'profiles'
CREATE TABLE public.profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  updated_at TIMESTAMP WITH TIME ZONE,
  email TEXT UNIQUE,
  full_name TEXT,
  username TEXT UNIQUE,
  role TEXT NOT NULL DEFAULT 'user'
);

-- 2.2. Buat fungsi & trigger untuk membuat profil baru secara otomatis.
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = ''
AS $$
BEGIN
  INSERT INTO public.profiles (id, email, role)
  VALUES (new.id, new.email, 'user');
  RETURN new;
END;
$$;

-- Buat trigger yang memanggil fungsi handle_new_user.
CREATE TRIGGER on_auth_user_created
AFTER INSERT ON auth.users
FOR EACH ROW EXECUTE PROCEDURE public.handle_new_user();

-- 2.3. Buat fungsi helper untuk mendapatkan peran user saat ini (digunakan di RLS policies).
CREATE OR REPLACE FUNCTION public.get_current_user_role()
RETURNS TEXT
LANGUAGE plpgsql
SECURITY DEFINER
SET search_path = ''
AS $$
DECLARE
  user_role TEXT;
BEGIN
  SELECT role INTO user_role
  FROM public.profiles
  WHERE id = auth.uid();
  RETURN user_role;
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    RETURN NULL;
END;
$$;


-- =============================================
-- BAGIAN 3: AKTIFKAN RLS DAN BUAT POLICIES
-- =============================================

-- 3.1. Aktifkan RLS pada tabel 'profiles'
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.profiles FORCE ROW LEVEL SECURITY;

-- Buat Policies untuk 'profiles'
CREATE POLICY "Users can view their own profile."
ON public.profiles FOR SELECT
USING (auth.uid() = id);

CREATE POLICY "Users can update their own profile."
ON public.profiles FOR UPDATE
USING (auth.uid() = id)
WITH CHECK (auth.uid() = id);

CREATE POLICY "Admins can view all profiles."
ON public.profiles FOR SELECT
USING (get_current_user_role() = 'admin');

CREATE POLICY "Admins can update any profile."
ON public.profiles FOR UPDATE
USING (get_current_user_role() = 'admin')
WITH CHECK (get_current_user_role() = 'admin');


-- 3.2. Buat tabel 'articles'
CREATE TABLE public.articles (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
  title TEXT NOT NULL,
  description TEXT,
  content TEXT,
  author TEXT,
  date DATE,
  read_time TEXT,
  image_url TEXT,
  featured BOOLEAN DEFAULT FALSE,
  language TEXT, -- 'id' or 'en'
  tags TEXT[]
);

-- 3.3. Aktifkan RLS pada tabel 'articles'
ALTER TABLE public.articles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.articles FORCE ROW LEVEL SECURITY;

-- Buat Policies untuk 'articles'
CREATE POLICY "Articles are publicly readable."
ON public.articles FOR SELECT
USING (true);

CREATE POLICY "Admins and operators can manage articles."
ON public.articles FOR ALL -- INSERT, UPDATE, DELETE
USING (get_current_user_role() IN ('admin', 'operator'))
WITH CHECK (get_current_user_role() IN ('admin', 'operator'));


-- =============================================
-- BAGIAN 4: MASUKKAN DATA CONTOH
-- =============================================

INSERT INTO public.articles (title, description, content, author, date, read_time, image_url, featured, language, tags)
VALUES
(
  'OpenAI Luncurkan GPT-5: Revolusi Baru dalam AI Conversational',
  'Model bahasa terbaru OpenAI menunjukkan kemampuan luar biasa dalam pemahaman konteks dan reasoning yang lebih mendalam.',
  '<p class="mb-4 text-lg leading-relaxed">OpenAI kembali menggebrak dunia teknologi dengan pengumuman peluncuran Generative Pre-trained Transformer 5, atau yang lebih dikenal sebagai GPT-5. Model bahasa terbaru ini digadang-gadang akan membawa revolusi baru dalam cara manusia berinteraksi dengan kecerdasan buatan.</p><p class="mb-4 text-lg leading-relaxed">Dibandingkan pendahulunya, GPT-4, model ini menunjukkan peningkatan signifikan dalam beberapa area kunci. Salah satu yang paling menonjol adalah kemampuan pemahaman konteks yang jauh lebih dalam dan luas. GPT-5 mampu mempertahankan alur percakapan yang kompleks dalam jangka waktu yang lebih lama, mengurangi repetisi, dan memberikan jawaban yang lebih relevan secara kontekstual.</p><h3 class="text-2xl font-bold text-white mt-6 mb-3">Peningkatan Kemampuan Penalaran</h3><p class="mb-4 text-lg leading-relaxed">Selain itu, kemampuan penalaran (reasoning) logis dan matematisnya juga ditingkatkan secara drastis. Dalam serangkaian tes benchmark, GPT-5 berhasil menyelesaikan masalah-masalah kompleks yang sebelumnya menjadi tantangan besar bagi model AI. Ini membuka pintu bagi aplikasi AI di bidang-bidang yang memerlukan analisis mendalam seperti riset ilmiah, analisis keuangan, dan bahkan diagnosa medis awal.</p><p class="text-lg leading-relaxed">"Kami tidak hanya ingin menciptakan model yang bisa ''berbicara'', tetapi juga model yang bisa ''berpikir'' dan membantu memecahkan masalah nyata," ujar Dr. Sarah Mitchell, kepala tim riset di OpenAI. "Dengan GPT-5, kami selangkah lebih dekat menuju tujuan tersebut."</p>',
  'Dr. Sarah Mitchell',
  '2025-01-15',
  '5 menit',
  'https://images.unsplash.com/photo-1677756119517-756a188d2d94?q=80&w=2070&auto=format&fit=crop',
  TRUE,
  'id',
  '{"GPT-5 Release", "AI Research Tools"}'
),
(
  'Microsoft Copilot Integration in Education: Transforming Learning',
  'How Microsoft''s AI assistant is revolutionizing the way students and educators approach learning and teaching.',
  '<p class="mb-4 text-lg leading-relaxed">Microsoft is making significant strides in the educational technology sector with the deep integration of its AI assistant, Copilot, into its suite of learning tools. This move is set to revolutionize traditional teaching and learning paradigms, offering personalized assistance to both students and educators on an unprecedented scale.</p><h3 class="text-2xl font-bold text-white mt-6 mb-3">A Personalized Tutor for Every Student</h3><p class="mb-4 text-lg leading-relaxed">For students, Copilot acts as a 24/7 personal tutor. It can explain complex concepts in simple terms, help with homework by providing hints instead of direct answers, and assist in research by summarizing long academic papers. The integration with tools like OneNote and Teams means students can get AI-powered help directly within their workflow.</p><p class="mb-4 text-lg leading-relaxed">"The goal is to foster a deeper understanding and encourage critical thinking, not just to provide easy answers," explains Prof. James Wilson, an educational technology consultant working with Microsoft. "Copilot guides students through their learning process, adapting to their individual pace and style."</p><h3 class="text-2xl font-bold text-white mt-6 mb-3">Empowering Educators</h3><p class="text-lg leading-relaxed">Educators also stand to benefit immensely. Copilot can automate administrative tasks such as creating lesson plans, generating quiz questions, and grading assignments, freeing up valuable time for them to focus on more impactful student interactions. It can also provide insights into class performance, highlighting topics where students are struggling collectively.</p>',
  'Prof. James Wilson',
  '2025-01-14',
  '7 minutes',
  'https://images.unsplash.com/photo-1446776811953-b23d579424c1?q=80&w=2072&auto=format&fit=crop',
  TRUE,
  'en',
  '{"AI Ethics in Education", "AI Research Tools"}'
);
```